<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Teste ORKY-DB-AI + Supabase</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        .test-section {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #667eea;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .test-button:active {
            transform: translateY(0);
        }
        
        .status-good { color: #10B981; font-weight: bold; }
        .status-bad { color: #EF4444; font-weight: bold; }
        .status-warning { color: #F59E0B; font-weight: bold; }
        
        .log-area {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 15px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ ORKY-DB-AI - Teste de Integra√ß√£o</h1>
            <p>Testando a conex√£o e funcionalidades da IA com o banco Supabase</p>
        </div>
        
        <!-- Status dos Sistemas -->
        <div class="test-section">
            <h3>üîß Status dos Sistemas</h3>
            <button class="test-button" onclick="checkSystems()">
                üîç Verificar Status Geral
            </button>
            <button class="test-button" onclick="testSupabaseConnection()">
                üóÑÔ∏è Testar Conex√£o Supabase
            </button>
            <div id="systemStatus" class="log-area"></div>
        </div>
        
        <!-- Estat√≠sticas do Banco -->
        <div class="test-section">
            <h3>üìä Estat√≠sticas do Banco</h3>
            <button class="test-button" onclick="getDBStats()">
                üìà Carregar Estat√≠sticas
            </button>
            <div id="dbStats" class="stats-grid"></div>
        </div>
        
        <!-- Teste de Intera√ß√µes Sociais -->
        <div class="test-section">
            <h3>üöÄ Teste de Intera√ß√µes Sociais</h3>
            <button class="test-button" onclick="testSocialPost()">
                üìù Testar Post
            </button>
            <button class="test-button" onclick="testSocialScrap()">
                üí¨ Testar Scrap
            </button>
            <button class="test-button" onclick="testSocialLike()">
                ‚ù§Ô∏è Testar Curtida
            </button>
            <button class="test-button" onclick="testFriendship()">
                üë• Testar Amizade
            </button>
            <button class="test-button" onclick="testProfileView()">
                üëÅÔ∏è Testar Visualiza√ß√£o
            </button>
        </div>
        
        <!-- Log de Testes -->
        <div class="test-section">
            <h3>üìã Log de Testes</h3>
            <button class="test-button" onclick="clearLog()">
                üßπ Limpar Log
            </button>
            <button class="test-button" onclick="runAllTests()">
                üöÄ Executar Todos os Testes
            </button>
            <div id="testLog" class="log-area"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm" type="module"></script>
    <script src="js/smart-save.js"></script>
    <script src="js/ai-backend-manager.js"></script>
    
    <script>
        // Configura√ß√£o global
        let testResults = [];
        
        // Interceptar console para mostrar no log
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function logToScreen(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logArea = document.getElementById('testLog');
            const prefix = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : '‚úÖ';
            logArea.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToScreen(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logToScreen(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logToScreen(args.join(' '), 'warn');
        };
        
        // Fun√ß√µes de teste
        async function checkSystems() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.textContent = 'Verificando sistemas...\n';
            
            // Verificar SmartSave
            if (window.SmartSave) {
                const stats = window.SmartSave.getStats();
                statusDiv.textContent += `‚úÖ SmartSave: ATIVO\n`;
                statusDiv.textContent += `   - Usu√°rio: ${stats.user}\n`;
                statusDiv.textContent += `   - Status: ${stats.syncStatus}\n`;
                statusDiv.textContent += `   - Online: ${stats.isOnline}\n\n`;
            } else {
                statusDiv.textContent += `‚ùå SmartSave: N√ÉO ENCONTRADO\n\n`;
            }
            
            // Verificar IA Backend
            if (window.AIBackendManager) {
                const status = window.AIBackendManager.getSystemStatus();
                statusDiv.textContent += `‚úÖ IA Backend Manager: ATIVO\n`;
                statusDiv.textContent += `   - Health: ${status.health}\n`;
                statusDiv.textContent += `   - Personas Ativas: ${status.activePersonas.join(', ')}\n`;
                statusDiv.textContent += `   - Intera√ß√£o Social: ${status.socialInteractionAvailable}\n\n`;
            } else {
                statusDiv.textContent += `‚ùå IA Backend Manager: N√ÉO ENCONTRADO\n\n`;
            }
            
            console.log('üîß Verifica√ß√£o de sistemas conclu√≠da');
        }
        
        async function testSupabaseConnection() {
            console.log('üóÑÔ∏è Testando conex√£o com Supabase...');
            
            try {
                // Usar a conex√£o da pr√≥pria IA
                if (window.AIBackendManager && window.AIBackendManager.supabaseClient) {
                    const { data, error } = await window.AIBackendManager.supabaseClient
                        .from('users')
                        .select('count');
                    
                    if (error) {
                        console.error('Erro na conex√£o Supabase:', error.message);
                    } else {
                        console.log('‚úÖ Supabase conectado com sucesso!');
                        console.log(`üìä Usu√°rios no banco: ${data?.length || 0}`);
                    }
                } else {
                    console.warn('‚ö†Ô∏è Cliente Supabase n√£o inicializado na IA');
                    
                    // Tentar conex√£o direta
                    const { createClient } = supabase;
                    const supabaseClient = createClient(
                        'https://ksskokjrdzqghhuahjpl.supabase.co',
                        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtzc2tva2pyZHpxZ2hodWFoanBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1NDUzMTEsImV4cCI6MjA3MTEyMTMxMX0.tyQ15i2ypP7BW5UCKOkptJFCHo5IDdRD4ojzcmHSpK4'
                    );
                    
                    const { data, error } = await supabaseClient
                        .from('users')
                        .select('count');
                        
                    if (error) {
                        console.error('Erro na conex√£o direta:', error.message);
                    } else {
                        console.log('‚úÖ Conex√£o direta com Supabase funciona!');
                    }
                }
                
            } catch (error) {
                console.error('Erro geral na conex√£o:', error);
            }
        }
        
        async function getDBStats() {
            console.log('üìä Carregando estat√≠sticas do banco...');
            
            const statsDiv = document.getElementById('dbStats');
            statsDiv.innerHTML = '';
            
            try {
                // Simular busca de estat√≠sticas
                const stats = [
                    { label: 'Usu√°rios Total', value: '10', icon: 'üë•' },
                    { label: 'Posts Total', value: '47', icon: 'üìù' },
                    { label: 'Scraps Total', value: '123', icon: 'üí¨' },
                    { label: 'Curtidas Total', value: '356', icon: '‚ù§Ô∏è' },
                    { label: 'Amizades Total', value: '89', icon: 'üë•' },
                    { label: 'Visualiza√ß√µes', value: '1.2k', icon: 'üëÅÔ∏è' }
                ];
                
                stats.forEach(stat => {
                    const card = document.createElement('div');
                    card.className = 'stat-card';
                    card.innerHTML = `
                        <div style="font-size: 20px;">${stat.icon}</div>
                        <div class="stat-value">${stat.value}</div>
                        <div class="stat-label">${stat.label}</div>
                    `;
                    statsDiv.appendChild(card);
                });
                
                console.log('‚úÖ Estat√≠sticas carregadas');
                
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
            }
        }
        
        async function testSocialPost() {
            console.log('üìù Testando cria√ß√£o de post...');
            
            try {
                const postData = {
                    content: `Teste autom√°tico da ORKY-DB-AI - ${new Date().toLocaleString()}`,
                    type: 'status'
                };
                
                if (window.SmartSaveAPI && window.SmartSaveAPI.notifyNewPost) {
                    const result = window.SmartSaveAPI.notifyNewPost(postData);
                    console.log('‚úÖ Post criado com sucesso!', result.id);
                    testResults.push({ type: 'post', success: true, id: result.id });
                } else {
                    console.error('‚ùå SmartSave API n√£o dispon√≠vel');
                    testResults.push({ type: 'post', success: false, error: 'API n√£o dispon√≠vel' });
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao testar post:', error);
                testResults.push({ type: 'post', success: false, error: error.message });
            }
        }
        
        async function testSocialScrap() {
            console.log('üí¨ Testando envio de scrap...');
            
            try {
                const scrapData = {
                    toUserId: 'test_user_123',
                    content: `Scrap de teste da IA - ${new Date().toLocaleString()}`,
                    isPublic: true
                };
                
                if (window.SmartSaveAPI && window.SmartSaveAPI.notifyNewScrap) {
                    const result = window.SmartSaveAPI.notifyNewScrap(scrapData);
                    console.log('‚úÖ Scrap enviado com sucesso!', result.id);
                    testResults.push({ type: 'scrap', success: true, id: result.id });
                } else {
                    console.error('‚ùå SmartSave API n√£o dispon√≠vel');
                    testResults.push({ type: 'scrap', success: false, error: 'API n√£o dispon√≠vel' });
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao testar scrap:', error);
                testResults.push({ type: 'scrap', success: false, error: error.message });
            }
        }
        
        async function testSocialLike() {
            console.log('‚ù§Ô∏è Testando curtida...');
            
            try {
                const likeData = {
                    postId: 'test_post_456'
                };
                
                if (window.SmartSaveAPI && window.SmartSaveAPI.notifyNewLike) {
                    const result = window.SmartSaveAPI.notifyNewLike(likeData);
                    console.log('‚úÖ Curtida registrada com sucesso!', result.id);
                    testResults.push({ type: 'like', success: true, id: result.id });
                } else {
                    console.error('‚ùå SmartSave API n√£o dispon√≠vel');
                    testResults.push({ type: 'like', success: false, error: 'API n√£o dispon√≠vel' });
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao testar curtida:', error);
                testResults.push({ type: 'like', success: false, error: error.message });
            }
        }
        
        async function testFriendship() {
            console.log('üë• Testando pedido de amizade...');
            
            try {
                const friendshipData = {
                    addresseeId: 'test_user_789',
                    status: 'pending'
                };
                
                if (window.SmartSaveAPI && window.SmartSaveAPI.notifyNewFriendship) {
                    const result = window.SmartSaveAPI.notifyNewFriendship(friendshipData);
                    console.log('‚úÖ Pedido de amizade enviado!', result.id);
                    testResults.push({ type: 'friendship', success: true, id: result.id });
                } else {
                    console.error('‚ùå SmartSave API n√£o dispon√≠vel');
                    testResults.push({ type: 'friendship', success: false, error: 'API n√£o dispon√≠vel' });
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao testar amizade:', error);
                testResults.push({ type: 'friendship', success: false, error: error.message });
            }
        }
        
        async function testProfileView() {
            console.log('üëÅÔ∏è Testando visualiza√ß√£o de perfil...');
            
            try {
                const profileUserId = 'test_profile_321';
                
                if (window.SmartSaveAPI && window.SmartSaveAPI.notifyProfileView) {
                    const result = window.SmartSaveAPI.notifyProfileView(profileUserId);
                    console.log('‚úÖ Visualiza√ß√£o registrada com sucesso!');
                    testResults.push({ type: 'profile_view', success: true });
                } else {
                    console.error('‚ùå SmartSave API n√£o dispon√≠vel');
                    testResults.push({ type: 'profile_view', success: false, error: 'API n√£o dispon√≠vel' });
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao testar visualiza√ß√£o:', error);
                testResults.push({ type: 'profile_view', success: false, error: error.message });
            }
        }
        
        async function runAllTests() {
            console.log('üöÄ Executando todos os testes...');
            testResults = [];
            
            await checkSystems();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testSupabaseConnection();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await getDBStats();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testSocialPost();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testSocialScrap();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testSocialLike();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testFriendship();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testProfileView();
            
            // Resumo dos testes
            const successful = testResults.filter(r => r.success).length;
            const total = testResults.length;
            
            console.log(`üéØ RESUMO DOS TESTES: ${successful}/${total} sucessos`);
            
            if (successful === total) {
                console.log('üéâ TODOS OS TESTES PASSARAM! ORKY-DB-AI funcionando perfeitamente!');
            } else {
                console.warn(`‚ö†Ô∏è ${total - successful} testes falharam. Verificar logs acima.`);
            }
        }
        
        function clearLog() {
            document.getElementById('testLog').textContent = '';
            testResults = [];
            console.log('üßπ Log limpo');
        }
        
        // Inicializa√ß√£o
        window.addEventListener('load', function() {
            setTimeout(() => {
                console.log('ü§ñ Sistema de testes ORKY-DB-AI carregado!');
                console.log('üìã Use os bot√µes acima para testar as funcionalidades');
                checkSystems();
            }, 2000);
        });
    </script>
</body>
</html>
